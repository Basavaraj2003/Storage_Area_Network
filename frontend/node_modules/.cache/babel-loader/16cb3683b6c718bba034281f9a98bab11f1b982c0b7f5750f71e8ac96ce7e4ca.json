{"ast":null,"code":"let ws = null;\nlet reconnectAttempts = 0;\nconst maxReconnectAttempts = 5;\nconst reconnectDelay = 3000;\nexport function connectWebSocket(onMessage, onError, onClose) {\n  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n  const host = window.location.hostname;\n  const port = process.env.REACT_APP_WS_PORT || '8000';\n  const wsUrl = `${protocol}//${host}:${port}/ws`;\n  try {\n    ws = new WebSocket(wsUrl);\n    ws.onopen = () => {\n      console.log('WebSocket connected');\n      reconnectAttempts = 0;\n      // Send ping to keep connection alive\n      setInterval(() => {\n        if (ws && ws.readyState === WebSocket.OPEN) {\n          ws.send('ping');\n        }\n      }, 30000);\n    };\n    ws.onmessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n        if (onMessage) {\n          onMessage(data);\n        }\n      } catch (error) {\n        console.error('Error parsing WebSocket message:', error);\n      }\n    };\n    ws.onerror = error => {\n      console.error('WebSocket error:', error);\n      if (onError) {\n        onError(error);\n      }\n    };\n    ws.onclose = () => {\n      console.log('WebSocket disconnected');\n      if (onClose) {\n        onClose();\n      }\n\n      // Attempt to reconnect\n      if (reconnectAttempts < maxReconnectAttempts) {\n        reconnectAttempts++;\n        console.log(`Attempting to reconnect (${reconnectAttempts}/${maxReconnectAttempts})...`);\n        setTimeout(() => {\n          connectWebSocket(onMessage, onError, onClose);\n        }, reconnectDelay);\n      } else {\n        console.error('Max reconnection attempts reached');\n      }\n    };\n  } catch (error) {\n    console.error('Failed to create WebSocket:', error);\n    if (onError) {\n      onError(error);\n    }\n  }\n}\nexport function disconnectWebSocket() {\n  if (ws) {\n    ws.close();\n    ws = null;\n  }\n}\nexport function sendMessage(message) {\n  if (ws && ws.readyState === WebSocket.OPEN) {\n    ws.send(JSON.stringify(message));\n  }\n}","map":{"version":3,"names":["ws","reconnectAttempts","maxReconnectAttempts","reconnectDelay","connectWebSocket","onMessage","onError","onClose","protocol","window","location","host","hostname","port","process","env","REACT_APP_WS_PORT","wsUrl","WebSocket","onopen","console","log","setInterval","readyState","OPEN","send","onmessage","event","data","JSON","parse","error","onerror","onclose","setTimeout","disconnectWebSocket","close","sendMessage","message","stringify"],"sources":["C:/sanfinal/frontend/src/services/websocket.js"],"sourcesContent":["let ws = null;\nlet reconnectAttempts = 0;\nconst maxReconnectAttempts = 5;\nconst reconnectDelay = 3000;\n\nexport function connectWebSocket(onMessage, onError, onClose) {\n  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n  const host = window.location.hostname;\n  const port = process.env.REACT_APP_WS_PORT || '8000';\n  const wsUrl = `${protocol}//${host}:${port}/ws`;\n\n  try {\n    ws = new WebSocket(wsUrl);\n\n    ws.onopen = () => {\n      console.log('WebSocket connected');\n      reconnectAttempts = 0;\n      // Send ping to keep connection alive\n      setInterval(() => {\n        if (ws && ws.readyState === WebSocket.OPEN) {\n          ws.send('ping');\n        }\n      }, 30000);\n    };\n\n    ws.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        if (onMessage) {\n          onMessage(data);\n        }\n      } catch (error) {\n        console.error('Error parsing WebSocket message:', error);\n      }\n    };\n\n    ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n      if (onError) {\n        onError(error);\n      }\n    };\n\n    ws.onclose = () => {\n      console.log('WebSocket disconnected');\n      if (onClose) {\n        onClose();\n      }\n      \n      // Attempt to reconnect\n      if (reconnectAttempts < maxReconnectAttempts) {\n        reconnectAttempts++;\n        console.log(`Attempting to reconnect (${reconnectAttempts}/${maxReconnectAttempts})...`);\n        setTimeout(() => {\n          connectWebSocket(onMessage, onError, onClose);\n        }, reconnectDelay);\n      } else {\n        console.error('Max reconnection attempts reached');\n      }\n    };\n  } catch (error) {\n    console.error('Failed to create WebSocket:', error);\n    if (onError) {\n      onError(error);\n    }\n  }\n}\n\nexport function disconnectWebSocket() {\n  if (ws) {\n    ws.close();\n    ws = null;\n  }\n}\n\nexport function sendMessage(message) {\n  if (ws && ws.readyState === WebSocket.OPEN) {\n    ws.send(JSON.stringify(message));\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}